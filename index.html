<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¶“å…¸è¸©åœ°é›·</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #c0c0c0; /* ç¶“å…¸ç°è‰²èƒŒæ™¯ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            user-select: none; /* é˜²æ­¢é¸å–æ–‡å­— */
        }

        h1 { margin-bottom: 10px; color: #333; }

        /* éŠæˆ²è³‡è¨Šåˆ— */
        .header {
            background: #c0c0c0;
            border: 3px solid;
            border-color: #808080 #fff #fff #808080; /* å…§å‡¹æ•ˆæœ */
            padding: 10px;
            width: 300px;
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: bold;
            font-size: 20px;
        }

        /* éŠæˆ²å€åŸŸ */
        #grid {
            display: grid;
            grid-template-columns: repeat(10, 30px);
            grid-template-rows: repeat(10, 30px);
            border: 4px solid;
            border-color: #fff #808080 #808080 #fff; /* å¤–å‡¸æ•ˆæœ */
        }

        /* æ¯å€‹æ ¼å­çš„æ¨£å¼ */
        .cell {
            width: 30px;
            height: 30px;
            background-color: #c0c0c0;
            border: 2px solid;
            border-color: #fff #808080 #808080 #fff; /* æŒ‰éˆ•æµ®èµ·æ•ˆæœ */
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 18px;
            cursor: pointer;
        }

        /* è¢«é»é–‹çš„æ ¼å­ */
        .cell.revealed {
            border: 1px solid #808080; /* è®Šå¹³ */
            background-color: #dcdcdc;
        }

        /* åœ°é›·æ¨£å¼ */
        .cell.mine {
            background-color: red;
        }

        /* æ——å­æ¨£å¼ */
        .cell.flag {
            color: red;
        }

        /* æ•¸å­—é¡è‰² */
        .c1 { color: blue; }
        .c2 { color: green; }
        .c3 { color: red; }
        .c4 { color: darkblue; }
        .c5 { color: brown; }
        .c6 { color: cyan; }
        .c7 { color: black; }
        .c8 { color: gray; }

        button {
            margin-top: 15px;
            padding: 8px 16px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <h1>ç¶“å…¸è¸©åœ°é›·</h1>
    
    <div class="header">
        <span id="flags-left">ğŸš© 10</span>
        <span id="status">ğŸ˜Š éŠæˆ²ä¸­</span>
    </div>

    <div id="grid"></div>

    <button onclick="initGame()">ğŸ”„ é‡æ–°é–‹å§‹</button>

    <script>
        const gridElement = document.getElementById('grid');
        const flagsLeftElement = document.getElementById('flags-left');
        const statusElement = document.getElementById('status');
        
        const width = 10;
        const bombAmount = 10;
        let squares = [];
        let isGameOver = false;
        let flags = 0;

        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            gridElement.innerHTML = '';
            squares = [];
            isGameOver = false;
            flags = 0;
            flagsLeftElement.innerHTML = 'ğŸš© ' + bombAmount;
            statusElement.innerHTML = 'ğŸ˜Š éŠæˆ²ä¸­';
            createBoard();
        }

        function createBoard() {
            // 1. éš¨æ©Ÿæ”¾ç½®åœ°é›·
            const bombsArray = Array(bombAmount).fill('bomb');
            const emptyArray = Array(width * width - bombAmount).fill('valid');
            const gameArray = emptyArray.concat(bombsArray);
            const shuffledArray = gameArray.sort(() => Math.random() - 0.5);

            for (let i = 0; i < width * width; i++) {
                const square = document.createElement('div');
                square.setAttribute('id', i);
                square.classList.add('cell');
                square.dataset.type = shuffledArray[i]; // æ¨™è¨˜æ˜¯å¦ç‚ºåœ°é›·

                // å·¦éµé»æ“Š
                square.addEventListener('click', function(e) {
                    click(square);
                });

                // å³éµæ’æ——
                square.oncontextmenu = function(e) {
                    e.preventDefault();
                    addFlag(square);
                }

                gridElement.appendChild(square);
                squares.push(square);
            }

            // è¨ˆç®—å‘¨åœåœ°é›·æ•¸
            for (let i = 0; i < squares.length; i++) {
                let total = 0;
                const isLeftEdge = (i % width === 0);
                const isRightEdge = (i % width === width - 1);

                if (squares[i].dataset.type === 'valid') {
                    if (i > 0 && !isLeftEdge && squares[i - 1].dataset.type === 'bomb') total++;
                    if (i > 9 && !isRightEdge && squares[i + 1 - width].dataset.type === 'bomb') total++;
                    if (i > 10 && squares[i - width].dataset.type === 'bomb') total++;
                    if (i > 11 && !isLeftEdge && squares[i - 1 - width].dataset.type === 'bomb') total++;
                    if (i < 98 && !isRightEdge && squares[i + 1].dataset.type === 'bomb') total++;
                    if (i < 90 && !isLeftEdge && squares[i - 1 + width].dataset.type === 'bomb') total++;
                    if (i < 88 && !isRightEdge && squares[i + 1 + width].dataset.type === 'bomb') total++;
                    if (i < 89 && squares[i + width].dataset.type === 'bomb') total++;
                    squares[i].setAttribute('data', total);
                }
            }
        }

        // æ’æ——é‚è¼¯
        function addFlag(square) {
            if (isGameOver) return;
            if (!square.classList.contains('revealed') && (flags < bombAmount)) {
                if (!square.classList.contains('flag')) {
                    square.classList.add('flag');
                    square.innerHTML = 'ğŸš©';
                    flags++;
                    flagsLeftElement.innerHTML = 'ğŸš© ' + (bombAmount - flags);
                    checkForWin();
                } else {
                    square.classList.remove('flag');
                    square.innerHTML = '';
                    flags--;
                    flagsLeftElement.innerHTML = 'ğŸš© ' + (bombAmount - flags);
                }
            }
        }

        // é»æ“Šé‚è¼¯
        function click(square) {
            let currentId = square.id;
            if (isGameOver) return;
            if (square.classList.contains('revealed') || square.classList.contains('flag')) return;

            if (square.dataset.type === 'bomb') {
                gameOver(square);
            } else {
                let total = square.getAttribute('data');
                if (total != 0) {
                    square.classList.add('revealed');
                    square.innerHTML = total;
                    square.classList.add('c' + total); // åŠ å…¥é¡è‰² class
                    return;
                }
                checkSquare(square, currentId);
            }
            square.classList.add('revealed');
        }

        // æ“´æ•£é‚è¼¯ (ç•¶é»åˆ°ç©ºç™½æ™‚è‡ªå‹•æ‰“é–‹å‘¨åœ)
        function checkSquare(square, currentId) {
            const isLeftEdge = (currentId % width === 0);
            const isRightEdge = (currentId % width === width - 1);

            setTimeout(() => {
                if (square.classList.contains('revealed')) return; // é˜²æ­¢é‡è¤‡æª¢æŸ¥
                square.classList.add('revealed');
                
                // æª¢æŸ¥å‘¨åœçš„8å€‹æ ¼å­
                // é€™è£¡çš„é‚è¼¯æ˜¯éè¿´ (Recursion)
                let checkList = [];
                // å·¦
                if (currentId > 0 && !isLeftEdge) checkList.push(parseInt(currentId) - 1);
                // å³ä¸Š
                if (currentId > 9 && !isRightEdge) checkList.push(parseInt(currentId) + 1 - width);
                // ä¸Š
                if (currentId > 10) checkList.push(parseInt(currentId) - width);
                // å·¦ä¸Š
                if (currentId > 11 && !isLeftEdge) checkList.push(parseInt(currentId) - 1 - width);
                // å³
                if (currentId < 98 && !isRightEdge) checkList.push(parseInt(currentId) + 1);
                // å·¦ä¸‹
                if (currentId < 90 && !isLeftEdge) checkList.push(parseInt(currentId) - 1 + width);
                // å³ä¸‹
                if (currentId < 88 && !isRightEdge) checkList.push(parseInt(currentId) + 1 + width);
                // ä¸‹
                if (currentId < 89) checkList.push(parseInt(currentId) + width);

                checkList.forEach(id => {
                    const newSquare = document.getElementById(id);
                    click(newSquare);
                });
            }, 10);
        }

        // éŠæˆ²çµæŸ
        function gameOver(square) {
            statusElement.innerHTML = 'ğŸ’¥ çˆ†ç‚¸äº†!';
            isGameOver = true;

            // é¡¯ç¤ºæ‰€æœ‰åœ°é›·
            squares.forEach(square => {
                if (square.dataset.type === 'bomb') {
                    square.innerHTML = 'ğŸ’£';
                    square.classList.remove('flag'); // ç§»é™¤æ——å­ä»¥å…æ··æ·†
                    square.classList.add('revealed', 'mine');
                }
            });
        }

        // æª¢æŸ¥å‹åˆ©
        function checkForWin() {
            let matches = 0;
            for (let i = 0; i < squares.length; i++) {
                if (squares[i].classList.contains('flag') && squares[i].dataset.type === 'bomb') {
                    matches++;
                }
            }
            if (matches === bombAmount) {
                statusElement.innerHTML = 'ğŸ˜ ä½ è´äº†!';
                isGameOver = true;
            }
        }

        // å•Ÿå‹•éŠæˆ²
        initGame();
    </script>
</body>
</html>
